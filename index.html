<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {font-family: "Segoe UI", sans-serif; background: #0f172a; color: #fff; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; direction:rtl;}
    .card {background:#1e293b; padding:25px; border-radius:20px; width:480px; box-shadow:0 8px 20px rgba(0,0,0,0.3);}
    h2 {text-align:center; margin-bottom:20px; color:#38bdf8;}
    label {display:block; margin:8px 0 5px;}
    input, select {width:100%; padding:10px; border:none; border-radius:10px; background:#334155; color:#fff; margin-bottom:10px;}
    button {width:100%; padding:12px; background:#38bdf8; border:none; border-radius:12px; color:#0f172a; font-weight:bold; cursor:pointer;}
    .results {display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:20px;}
    .box {background:#0f172a; padding:12px; border-radius:12px; text-align:center; font-weight:bold;}
    .profit {color:#22c55e;} .loss {color:#ef4444;} .info {color:#38bdf8;}
    canvas {margin-top:20px; background:#0f172a; border-radius:12px; padding:10px;}
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸ“Š Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø·ÙˆØ±Ø©</h2>

    <label>Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ (IMR %)</label>
    <input type="number" id="imr" placeholder="Ù…Ø«Ø§Ù„: 2" oninput="updateLeverageOptions()">

    <label>Ù‡Ø§Ù…Ø´ Ø§Ù„Ø­ÙÙØ§Ø¸ (MMR %)</label>
    <input type="number" id="mmr" placeholder="Ù…Ø«Ø§Ù„: 1" oninput="updateLeverageOptions()">

    <label id="leverageLabel" style="display: none;">Ø§Ù„Ø±Ø§ÙØ¹Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</label>
    <select id="leverageSelect" style="display: none;"></select>

    <label>Ø§Ù„Ù…Ø¨Ù„Øº (USDT)</label>
    <input type="number" id="capital" placeholder="Ù…Ø«Ø§Ù„: 10">

    <label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
    <input type="number" id="currentPrice" placeholder="Ù…Ø«Ø§Ù„: 1.00">

    <label>Ø³Ø¹Ø± Ø§Ù„Ù‡Ø¯Ù</label>
    <input type="number" id="targetPrice" placeholder="Ù…Ø«Ø§Ù„: 1.05">

    <label>Ø§Ù„Ø§ØªØ¬Ø§Ù‡</label>
    <select id="direction">
      <option value="long">ğŸ“ˆ Ø´Ø±Ø§Ø¡ (Long)</option>
      <option value="short">ğŸ“‰ Ø¨ÙŠØ¹ (Short)</option>
    </select>

    <button onclick="calculate()">Ø§Ø­Ø³Ø¨</button>

    <div class="results">
      <div class="box info" id="marginDiff">ÙØ±Ù‚ Ø§Ù„Ù‡Ø§Ù…Ø´: -</div>
      <div class="box info" id="priceChangeBox">Ø§Ù„ØªØºÙŠØ±: -</div>
      <div class="box profit" id="roiBox">ROI: -</div>
      <div class="box info" id="pnlBox">PnL: -</div>
      <div class="box loss" id="liqBox">Ø§Ù„ØªØµÙÙŠØ©: -</div>
    </div>

    <canvas id="chart" height="120"></canvas>
  </div>

  <script>
    let chart;
    
    function updateLeverageOptions() {
      let imr = parseFloat(document.getElementById("imr").value);
      let mmr = parseFloat(document.getElementById("mmr").value);
      
      let leverageSelect = document.getElementById("leverageSelect");
      let leverageLabel = document.getElementById("leverageLabel");
      leverageSelect.innerHTML = "";
      
      if (isNaN(imr) || isNaN(mmr) || imr <= mmr || imr <= 0) {
        leverageLabel.style.display = "none";
        leverageSelect.style.display = "none";
        return;
      }

      let marginDifference = imr - mmr;
      let maxLeverage = 100 / marginDifference;

      let leverageOptions = [
        { value: 5, text: `5x (Ù…Ø®Ø§Ø·Ø± Ù…Ù†Ø®ÙØ¶Ø©)` },
        { value: 10, text: `10x (Ù…Ø®Ø§Ø·Ø± Ù…Ù†Ø®ÙØ¶Ø©)` },
        { value: 20, text: `20x (Ù…Ø®Ø§Ø·Ø± Ù…ØªÙˆØ³Ø·Ø©)` },
        { value: 30, text: `30x (Ù…Ø®Ø§Ø·Ø± Ù…ØªÙˆØ³Ø·Ø©)` },
        { value: 50, text: `50x (Ù…Ø®Ø§Ø·Ø± Ø¹Ø§Ù„ÙŠØ©)` },
        { value: 100, text: `100x (Ù…Ø®Ø§Ø·Ø± Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ù‹Ø§)` }
      ];

      leverageOptions.forEach(option => {
        if (maxLeverage >= option.value) {
            let opt = document.createElement("option");
            opt.value = option.value;
            opt.textContent = option.text;
            leverageSelect.appendChild(opt);
        }
      });
      
      let optMax = document.createElement("option");
      optMax.value = maxLeverage;
      optMax.textContent = `${maxLeverage.toFixed(2)}x (Ø§Ù„Ø±Ø§ÙØ¹Ø© Ø§Ù„Ù‚ØµÙˆÙ‰ Ø§Ù„Ù…ØªØ§Ø­Ø©)`;
      leverageSelect.appendChild(optMax);

      leverageLabel.style.display = "block";
      leverageSelect.style.display = "block";
    }

    function calculate() {
      let leverage = parseFloat(document.getElementById("leverageSelect").value);
      let imr = parseFloat(document.getElementById("imr").value);
      let mmr = parseFloat(document.getElementById("mmr").value);
      let capital = parseFloat(document.getElementById("capital").value);
      let currentPrice = parseFloat(document.getElementById("currentPrice").value);
      let targetPrice = parseFloat(document.getElementById("targetPrice").value);
      let direction = document.getElementById("direction").value;

      if (isNaN(leverage) || [imr, mmr, capital, currentPrice, targetPrice].some(isNaN) || imr <= mmr || imr <= 0) {
        alert("âš ï¸ Ø±Ø¬Ø§Ø¡Ù‹ Ø§Ø®ØªØ± Ø§Ù„Ø±Ø§ÙØ¹Ø© Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø£Ø¯Ø®Ù„ ÙƒÙ„ Ø§Ù„Ù‚ÙŠÙ….");
        return;
      }
      
      let marginDiff = imr - mmr;
      let priceChange = ((targetPrice - currentPrice) / currentPrice) * 100;
      if (direction === "short") priceChange *= -1;
      let roiPercent = priceChange * leverage;
      let pnlValue = (capital * roiPercent) / 100;

      let liquidationPrice;
      if (direction === "long") {
        liquidationPrice = currentPrice * (1 - (marginDiff / 100));
      } else {
        liquidationPrice = currentPrice * (1 + (marginDiff / 100));
      }

      document.getElementById("marginDiff").innerHTML = `ğŸ›¡ï¸ ÙØ±Ù‚ Ø§Ù„Ù‡Ø§Ù…Ø´: ${marginDiff.toFixed(2)}%`;
      document.getElementById("priceChangeBox").innerHTML = `ğŸ”¹ Ø§Ù„ØªØºÙŠØ±: ${priceChange.toFixed(2)}%`;
      document.getElementById("roiBox").innerHTML = `ğŸ’° ROI: ${roiPercent.toFixed(2)}%`;
      document.getElementById("pnlBox").innerHTML = `ğŸ“ˆ PnL: ${pnlValue.toFixed(2)} USDT`;
      document.getElementById("liqBox").innerHTML = `âš ï¸ Ø§Ù„ØªØµÙÙŠØ©: ${liquidationPrice.toFixed(4)}`;

      let ctx = document.getElementById("chart").getContext("2d");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: ["Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ", "Ø§Ù„Ù‡Ø¯Ù", "Ø§Ù„ØªØµÙÙŠØ©"],
          datasets: [{
            label: "Ø§Ù„Ø³Ø¹Ø±",
            data: [currentPrice, targetPrice, liquidationPrice],
            borderColor: "#38bdf8",
            backgroundColor: "#38bdf8",
            tension: 0.2,
            fill: false
          }]
        },
        options: {plugins:{legend:{display:false}}, scales:{x:{ticks:{color:"#fff"}},y:{ticks:{color:"#fff"}}}}
      });
    }
  </script>
</body>
</html>
