        <!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg-color: #0d1117;
      --card-bg: #161b22;
      --input-bg: #21262d;
      --text-color: #c9d1d9;
      --primary-color: #58a6ff;
      --success-color: #3fb950;
      --danger-color: #f85149;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      direction: rtl;
    }
    .card {
      background: var(--card-bg);
      padding: 30px;
      border-radius: 20px;
      width: 500px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 1px solid #30363d;
      max-width: 90%;
    }
    h2 {
      text-align: center;
      margin-bottom: 25px;
      color: var(--primary-color);
      font-weight: 600;
    }
    label {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 15px 0 5px;
      font-size: 14px;
      font-weight: 500;
    }
    .tooltip-icon {
      font-weight: bold;
      color: var(--primary-color);
      cursor: pointer;
      font-size: 16px;
      position: relative;
    }
    .tooltip-text {
      visibility: hidden;
      width: 200px;
      background-color: var(--input-bg);
      color: var(--text-color);
      text-align: center;
      border-radius: 6px;
      padding: 10px;
      position: absolute;
      z-index: 1;
      right: 0;
      top: 120%;
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 12px;
      line-height: 1.5;
      border: 1px solid #444c56;
    }
    .tooltip-icon:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }
    input, select {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--input-bg);
      border-radius: 10px;
      background: var(--input-bg);
      color: var(--text-color);
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    input:focus, select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.2);
    }
    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
    }
    .btn-group button {
      flex: 1;
      padding: 10px;
      background: var(--input-bg);
      border: 1px solid #444c56;
      border-radius: 8px;
      color: var(--text-color);
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s, border-color 0.2s;
    }
    .btn-group button.active, .btn-group button:hover {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: #fff;
    }
    #calculateBtn {
      width: 100%;
      padding: 15px;
      background: var(--primary-color);
      border: none;
      border-radius: 12px;
      color: var(--bg-color);
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }
    #calculateBtn:hover {
      background: #478bff;
    }
    .results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 15px;
      margin-top: 25px;
    }
    .box {
      background: var(--input-bg);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      font-weight: 500;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 70px;
    }
    .box-label {
      font-size: 12px;
      color: #8b949e;
      margin-bottom: 5px;
    }
    .box-value {
      font-size: 18px;
      font-weight: bold;
    }
    .profit { color: var(--success-color); } 
    .loss { color: var(--danger-color); } 
    .info { color: var(--primary-color); }
    canvas {
      margin-top: 25px;
      background-color: #21262d; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© ÙˆØ§Ø¶Ø­ */
      border-radius: 12px;
      padding: 15px;
      border: 1px solid #30363d;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸ“Š Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h2>

    <label>Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ (IMR %)
      <span class="tooltip-icon">i<span class="tooltip-text">Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„ØµÙÙ‚Ø© Ø§Ù„ØªÙŠ ØªÙˆØ¯Ø¹Ù‡Ø§.</span></span>
    </label>
    <input type="number" id="imr" placeholder="Ù…Ø«Ø§Ù„: 2" oninput="updateUI()">

    <label>Ù‡Ø§Ù…Ø´ Ø§Ù„Ø­ÙÙØ§Ø¸ (MMR %)
      <span class="tooltip-icon">i<span class="tooltip-text">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù…Ù† Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØµÙÙ‚Ø©.</span></span>
    </label>
    <input type="number" id="mmr" placeholder="Ù…Ø«Ø§Ù„: 1" oninput="updateUI()">

    <label>Ø§Ø®ØªØ± Ø§Ù„Ø±Ø§ÙØ¹Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</label>
    <div id="leverageButtons" class="btn-group"></div>

    <label>Ø§Ù„Ù…Ø¨Ù„Øº (USDT)</label>
    <input type="number" id="capital" placeholder="Ù…Ø«Ø§Ù„: 10" oninput="updateUI()">

    <label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
    <input type="number" id="currentPrice" placeholder="Ù…Ø«Ø§Ù„: 1.00" oninput="updateUI()">

    <label>Ø³Ø¹Ø± Ø§Ù„Ù‡Ø¯Ù</label>
    <input type="number" id="targetPrice" placeholder="Ù…Ø«Ø§Ù„: 1.05" oninput="updateUI()">

    <label>Ø§Ù„Ø§ØªØ¬Ø§Ù‡</label>
    <select id="direction" onchange="updateUI()">
      <option value="long">ğŸ“ˆ Ø´Ø±Ø§Ø¡ (Long)</option>
      <option value="short">ğŸ“‰ Ø¨ÙŠØ¹ (Short)</option>
    </select>

    <div class="results">
      <div class="box info">
        <div class="box-label">ÙØ±Ù‚ Ø§Ù„Ù‡Ø§Ù…Ø´</div>
        <div class="box-value" id="marginDiff">-</div>
      </div>
      <div class="box info">
        <div class="box-label">Ø§Ù„ØªØºÙŠØ± %</div>
        <div class="box-value" id="priceChangeBox">-</div>
      </div>
      <div class="box profit">
        <div class="box-label">ROI %</div>
        <div class="box-value" id="roiBox">-</div>
      </div>
      <div class="box info">
        <div class="box-label">PnL USDT</div>
        <div class="box-value" id="pnlBox">-</div>
      </div>
      <div class="box loss">
        <div class="box-label">Ø³Ø¹Ø± Ø§Ù„ØªØµÙÙŠØ©</div>
        <div class="box-value" id="liqBox">-</div>
      </div>
    </div>

    <canvas id="chart" height="120"></canvas>
  </div>

  <script>
    let chart;
    let selectedLeverage = null;

    function updateUI() {
      updateLeverageOptions();
      calculate();
    }

    function updateLeverageOptions() {
      const imr = parseFloat(document.getElementById("imr").value);
      const mmr = parseFloat(document.getElementById("mmr").value);
      const btnContainer = document.getElementById("leverageButtons");
      btnContainer.innerHTML = "";

      if (isNaN(imr) || isNaN(mmr) || imr <= mmr || imr <= 0) {
        selectedLeverage = null;
        return;
      }

      const marginDifference = imr - mmr;
      const maxLeverage = 100 / marginDifference;

      const leverageOptions = [
        { value: 5, text: `5x (Ù…Ù†Ø®ÙØ¶Ø©)` },
        { value: 10, text: `10x (Ù…Ù†Ø®ÙØ¶Ø©)` },
        { value: 20, text: `20x (Ù…ØªÙˆØ³Ø·Ø©)` },
        { value: 30, text: `30x (Ù…ØªÙˆØ³Ø·Ø©)` },
        { value: 50, text: `50x (Ø¹Ø§Ù„ÙŠØ©)` },
        { value: 100, text: `100x (Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹)` }
      ];

      leverageOptions.forEach(option => {
        if (maxLeverage >= option.value) {
          const btn = document.createElement("button");
          btn.textContent = option.text;
          btn.value = option.value;
          btn.onclick = () => {
            selectedLeverage = option.value;
            document.querySelectorAll('.btn-group button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            calculate();
          };
          btnContainer.appendChild(btn);
        }
      });
      
      const maxBtn = document.createElement("button");
      maxBtn.textContent = `${maxLeverage.toFixed(2)}x (Ø§Ù„Ù‚ØµÙˆÙ‰)`;
      maxBtn.value = maxLeverage;
      maxBtn.onclick = () => {
        selectedLeverage = maxLeverage;
        document.querySelectorAll('.btn-group button').forEach(b => b.classList.remove('active'));
        maxBtn.classList.add('active');
        calculate();
      };
      btnContainer.appendChild(maxBtn);
    }

    function calculate() {
      const imr = parseFloat(document.getElementById("imr").value);
      const mmr = parseFloat(document.getElementById("mmr").value);
      const capital = parseFloat(document.getElementById("capital").value);
      const currentPrice = parseFloat(document.getElementById("currentPrice").value);
      const targetPrice = parseFloat(document.getElementById("targetPrice").value);
      const direction = document.getElementById("direction").value;
      
      if (selectedLeverage === null || [imr, mmr, capital, currentPrice, targetPrice].some(isNaN) || imr <= mmr || imr <= 0) {
        document.getElementById("marginDiff").innerHTML = '-';
        document.getElementById("priceChangeBox").innerHTML = '-';
        document.getElementById("roiBox").innerHTML = '-';
        document.getElementById("pnlBox").innerHTML = '-';
        document.getElementById("liqBox").innerHTML = '-';
        if (chart) chart.destroy();
        return;
      }

      const leverage = selectedLeverage;
      const marginDiff = imr - mmr;
      const priceChange = ((targetPrice - currentPrice) / currentPrice) * 100;
      const actualPriceChange = direction === "short" ? -priceChange : priceChange;
      const roiPercent = actualPriceChange * leverage;
      const pnlValue = (capital * roiPercent) / 100;

      let liquidationPrice;
      if (direction === "long") {
        liquidationPrice = currentPrice * (1 - (marginDiff / 100));
      } else {
        liquidationPrice = currentPrice * (1 + (marginDiff / 100));
      }

      document.getElementById("marginDiff").innerHTML = `${marginDiff.toFixed(2)}%`;
      document.getElementById("priceChangeBox").innerHTML = `${actualPriceChange.toFixed(2)}%`;
      document.getElementById("roiBox").innerHTML = `${roiPercent.toFixed(2)}%`;
      document.getElementById("pnlBox").innerHTML = `${pnlValue.toFixed(2)} USDT`;
      document.getElementById("liqBox").innerHTML = `${liquidationPrice.toFixed(4)}`;

      let ctx = document.getElementById("chart").getContext("2d");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: ["Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ", "Ø§Ù„Ù‡Ø¯Ù", "Ø§Ù„ØªØµÙÙŠØ©"],
          datasets: [{
            label: "Ø§Ù„Ø³Ø¹Ø±",
            data: [currentPrice, targetPrice, liquidationPrice],
            borderColor: "#58a6ff", // Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ ØµØ±ÙŠØ­
            backgroundColor: "#58a6ff", // Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ ØµØ±ÙŠØ­
            tension: 0.3,
            fill: false
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            x: { 
              ticks: { color: "#c9d1d9" }, // Ù„ÙˆÙ† Ù†Øµ ØµØ±ÙŠØ­
              grid: { color: "rgba(201, 209, 217, 0.1)" } // Ù„ÙˆÙ† Ø®Ø· Ø§Ù„Ø´Ø¨ÙƒØ©
            },
            y: { 
              ticks: { color: "#c9d1d9" }, // Ù„ÙˆÙ† Ù†Øµ ØµØ±ÙŠØ­
              grid: { color: "rgba(201, 209, 217, 0.1)" } // Ù„ÙˆÙ† Ø®Ø· Ø§Ù„Ø´Ø¨ÙƒØ©
            }
          }
        }
      });
    }

    // Call updateUI on page load to initialize the state
    window.onload = updateUI;
  </script>
</body>
</html>
