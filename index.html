<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {font-family: "Segoe UI", sans-serif; background: #0f172a; color: #fff; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; direction:rtl;}
    .card {background:#1e293b; padding:25px; border-radius:20px; width:480px; box-shadow:0 8px 20px rgba(0,0,0,0.3);}
    h2 {text-align:center; margin-bottom:20px; color:#38bdf8;}
    label {display:block; margin:8px 0 5px;}
    input, select {width:100%; padding:10px; border:none; border-radius:10px; background:#334155; color:#fff; margin-bottom:10px;}
    button {width:100%; padding:12px; background:#38bdf8; border:none; border-radius:12px; color:#0f172a; font-weight:bold; cursor:pointer;}
    .results {display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:20px;}
    .box {background:#0f172a; padding:12px; border-radius:12px; text-align:center; font-weight:bold;}
    .profit {color:#22c55e;} .loss {color:#ef4444;} .info {color:#38bdf8;}
    canvas {margin-top:20px; background:#0f172a; border-radius:12px; padding:10px;}
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸ“Š Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø·ÙˆØ±Ø©</h2>

    <label>Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ (IMR %)</label>
    <input type="number" id="imr" placeholder="Ù…Ø«Ø§Ù„: 2">

    <label>Ù‡Ø§Ù…Ø´ Ø§Ù„Ø­ÙÙØ§Ø¸ (MMR %)</label>
    <input type="number" id="mmr" placeholder="Ù…Ø«Ø§Ù„: 1">

    <label>Ø§Ù„Ù…Ø¨Ù„Øº (USDT)</label>
    <input type="number" id="capital" placeholder="Ù…Ø«Ø§Ù„: 10">

    <label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
    <input type="number" id="currentPrice" placeholder="Ù…Ø«Ø§Ù„: 1.00">

    <label>Ø³Ø¹Ø± Ø§Ù„Ù‡Ø¯Ù</label>
    <input type="number" id="targetPrice" placeholder="Ù…Ø«Ø§Ù„: 1.05">

    <label>Ø§Ù„Ø§ØªØ¬Ø§Ù‡</label>
    <select id="direction">
      <option value="long">ğŸ“ˆ Ø´Ø±Ø§Ø¡ (Long)</option>
      <option value="short">ğŸ“‰ Ø¨ÙŠØ¹ (Short)</option>
    </select>

    <button onclick="calculate()">Ø§Ø­Ø³Ø¨</button>

    <div class="results">
      <div class="box info" id="levBox">Ø§Ù„Ø±Ø§ÙØ¹Ø©: -</div>
      <div class="box info" id="marginDiff">ÙØ±Ù‚ Ø§Ù„Ù‡Ø§Ù…Ø´: -</div>
      <div class="box info" id="priceChangeBox">Ø§Ù„ØªØºÙŠØ±: -</div>
      <div class="box profit" id="roiBox">ROI: -</div>
      <div class="box info" id="pnlBox">PnL: -</div>
      <div class="box loss" id="liqBox">Ø§Ù„ØªØµÙÙŠØ©: -</div>
    </div>

    <canvas id="chart" height="120"></canvas>
  </div>

  <script>
    let chart;
    function calculate() {
      let imr = parseFloat(document.getElementById("imr").value);
      let mmr = parseFloat(document.getElementById("mmr").value);
      let capital = parseFloat(document.getElementById("capital").value);
      let currentPrice = parseFloat(document.getElementById("currentPrice").value);
      let targetPrice = parseFloat(document.getElementById("targetPrice").value);
      let direction = document.getElementById("direction").value;

      if ([imr, mmr, capital, currentPrice, targetPrice].some(isNaN)) {
        alert("âš ï¸ Ø±Ø¬Ø§Ø¡Ù‹ Ø£Ø¯Ø®Ù„ ÙƒÙ„ Ø§Ù„Ù‚ÙŠÙ…");
        return;
      }

      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ÙØ¹Ø© Ù…Ù† IMR
      let leverage = 100 / imr;

      // ÙØ±Ù‚ Ø§Ù„Ø£Ù…Ø§Ù† Ø¨ÙŠÙ† IMR Ùˆ MMR
      let marginDiff = imr - mmr;

      // Ø§Ù„ØªØºÙŠØ± Ø§Ù„Ø³Ø¹Ø±ÙŠ %
      let priceChange = ((targetPrice - currentPrice) / currentPrice) * 100;
      if (direction === "short") priceChange *= -1;

      // ROI %
      let roiPercent = priceChange * leverage;
      let pnlValue = capital * (roiPercent / 100);

      // Ø³Ø¹Ø± Ø§Ù„ØªØµÙÙŠØ© (ØªÙ‚Ø±ÙŠØ¨ÙŠ)
      let liquidationPrice;
      if (direction === "long") {
        liquidationPrice = currentPrice * (1 - (1 / leverage) + mmr / 100);
      } else {
        liquidationPrice = currentPrice * (1 + (1 / leverage) - mmr / 100);
      }

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      document.getElementById("levBox").innerHTML = `âš¡ ${leverage.toFixed(2)}x`;
      document.getElementById("marginDiff").innerHTML = `ğŸ›¡ï¸ ${marginDiff.toFixed(2)}%`;
      document.getElementById("priceChangeBox").innerHTML = `ğŸ”¹ ${priceChange.toFixed(2)}%`;
      document.getElementById("roiBox").innerHTML = `ğŸ’° ROI: ${roiPercent.toFixed(2)}%`;
      document.getElementById("pnlBox").innerHTML = `ğŸ“ˆ ${pnlValue.toFixed(2)} USDT`;
      document.getElementById("liqBox").innerHTML = `âš ï¸ ${liquidationPrice.toFixed(4)}`;

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
      let ctx = document.getElementById("chart").getContext("2d");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: ["Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ", "Ø§Ù„Ù‡Ø¯Ù", "Ø§Ù„ØªØµÙÙŠØ©"],
          datasets: [{
            label: "Ø§Ù„Ø³Ø¹Ø±",
            data: [currentPrice, targetPrice, liquidationPrice],
            borderColor: "#38bdf8",
            backgroundColor: "#38bdf8",
            tension: 0.2,
            fill: false
          }]
        },
        options: {plugins:{legend:{display:false}}, scales:{x:{ticks:{color:"#fff"}},y:{ticks:{color:"#fff"}}}}
      });
    }
  </script>
</body>
</html>
